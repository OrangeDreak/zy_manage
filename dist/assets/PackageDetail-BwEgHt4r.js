import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as f,d as c,e as s,R,S as K,T as Q,m as b,w as i,g as d,I as U,f as l,p as N,k as n,F as w,J as M,H as W,t as h,U as q,Q as H,V as J,n as y,P as Y}from"./index-CrQX_ENc.js";import{p as C,e as G,a as X}from"./order-BawGe9CR.js";import{c as I}from"./commonUtil-265gjw8e.js";import{h as Z}from"./clipboard-VcplCzGY.js";/* empty css              */const j={name:"Index",props:{isMilliSecond:{type:Boolean,default:!1},end:{type:[String,Number],default:0}},data(){return{days:"0",hours:"00",mins:"00",seconds:"00",timer:null,curTime:0}},computed:{duration(){return String(this.end).length>=13?+this.end:+this.end*1e3}},watch:{curTime(o,e){e<=1100&&e>0&&this.$emit("countDownEnd")}},mounted(){this.countDown()},methods:{countDown(){this.curTime=this.duration-Date.now(),this.getTime(this.curTime)},getTime(o){if(this.curTime<0){this.timer&&clearTimeout(this.timer);return}const{dd:e,hh:p,mm:m,ss:t}=this.durationFormatter(Math.floor(o/1e3));this.days=e||0,this.hours=p||0,this.mins=m||0,this.seconds=t||0,this.timer=setTimeout(()=>{const a=Date.now();this.curTime=Math.floor(this.duration-a),this.getTime(this.curTime)},1e3)},durationFormatter(o){if(!o)return{ss:0};let e=o;const p=e%60;if(e=(e-p)/60,e<1)return{ss:p};const m=e%60;if(e=(e-m)/60,e<1)return{mm:m,ss:p};const t=e%24;return e=(e-t)/24,e<1?{hh:t,mm:m,ss:p}:{dd:e,hh:t,mm:m,ss:p}}}},ee={class:"_base-count-down"},te={class:"content"};function oe(o,e,p,m,t,a){return c(),f("div",ee,[s("div",te,[R(o.$slots,"default",K(Q({d:t.days,h:t.hours,m:t.mins,s:t.seconds,hh:`00${t.hours}`.slice(-2),mm:`00${t.mins}`.slice(-2),ss:`00${t.seconds}`.slice(-2),curTime:t.curTime})))])])}const ie=F(j,[["render",oe]]),le={props:{orderInfo:{type:Object,default:{}}},data(){return{videoForm:{status:!1,videoUrl:""},uploadLoading:!1,subLoading:!1}},watch:{orderInfo:{handler(o){this.videoForm.videoUrl=o.packagingVideo},deep:!0}},methods:{onEdit(){this.videoForm.status=!0},onDel(){this.$confirm("是否确认删除该视频？",{confirmButtonText:"确认",cancelButtonText:"我再想想",type:"warning"}).then(()=>{C({packageOrderId:this.$route.params.id,packagingVideo:""}).then(()=>{this.videoForm.status=!1,this.subLoading=!1,this.$message.success("删除成功"),this.$emit("finish")}).catch(()=>{this.subLoading=!1})}).catch(()=>{})},onSubmit(){if(!this.videoForm.videoUrl){this.$message.error("请上传视频文件");return}this.subLoading=!0,C({packageOrderId:this.$route.params.id,packagingVideo:this.videoForm.videoUrl}).then(()=>{this.videoForm.status=!1,this.subLoading=!1,this.$message.success("视频保存成功"),this.$emit("finish")}).catch(()=>{this.subLoading=!1})},onCancel(){this.videoForm.videoUrl=this.orderInfo.packagingVideo,this.videoForm.status=!1},beforeUploadVideo(o){this.uploadLoading=!0;var e=o.size/1024/1024<200;if(["video/mp4","video/flv","video/avi","video/rmvb","video/mov"].indexOf(o.type)==-1)return this.$message.error("请上传正确的视频格式"),this.uploadLoading=!1,!1;if(!e)return this.$message.error("视频大小不能超过200MB"),this.uploadLoading=!1,!1},cleanFileList(){this.videoForm={title:"",videoUrl:""}},handleVideoSuccess(o,e,p){this.uploadLoading=!1,o.code==200&&(this.videoForm.videoUrl=o.data.url,p.length>1&&p.splice(0,1))}}},ae={slot:"header",class:"video-header"},se={class:"video-box"},re=["src"];function ne(o,e,p,m,t,a){const v=d("el-button"),k=d("el-upload"),S=d("el-form-item"),g=d("el-form"),T=d("el-card"),_=U("loading");return c(),b(T,{class:"list",shadow:"never"},{default:i(()=>[s("div",ae,[e[4]||(e[4]=s("span",null,"包装过程视频",-1)),s("div",null,[t.videoForm.status?(c(),f(w,{key:1},[l(v,{plain:"",onClick:a.onCancel},{default:i(()=>e[1]||(e[1]=[n("取消")])),_:1},8,["onClick"]),l(v,{type:"primary",onClick:a.onSubmit},{default:i(()=>e[2]||(e[2]=[n("保存")])),_:1},8,["onClick"])],64)):(c(),b(v,{key:0,type:"primary",onClick:a.onEdit},{default:i(()=>e[0]||(e[0]=[n("编辑")])),_:1},8,["onClick"])),t.videoForm.status?N("",!0):(c(),b(v,{key:2,type:"primary",onClick:a.onDel},{default:i(()=>e[3]||(e[3]=[n("删除")])),_:1},8,["onClick"]))])]),l(g,{ref:"videoForm",model:t.videoForm,size:"small","label-width":"0px"},{default:i(()=>[l(S,{label:"",prop:"videoUrl"},{default:i(()=>[s("div",se,[t.videoForm.videoUrl?(c(),f("video",{key:0,width:"360",height:"180",controls:"",src:t.videoForm.videoUrl},null,8,re)):N("",!0),t.videoForm.status?(c(),b(k,{key:1,ref:"videoUpload",class:"video-uploade",drag:"",action:"http://192.168.0.101:8081/tp/admin/resource/oss/upload",accept:".mp4,.flv,.avi.rmb,.mov","on-success":a.handleVideoSuccess,"before-upload":a.beforeUploadVideo,"show-file-list":!1},{default:i(()=>[M((c(),f("div",null,e[5]||(e[5]=[s("i",{class:"el-icon-upload"},null,-1),s("div",{class:"el-upload__text"},[n("将文件拖到此处，或"),s("em",null,"点击上传")],-1)]))),[[_,t.uploadLoading]]),e[6]||(e[6]=s("div",{class:"el-upload__tip",slot:"tip"}," 只能上传mp4/flv/avi/rmvb/mov文件，且不超过200M ",-1))]),_:1},8,["on-success","before-upload"])):N("",!0)])]),_:1})]),_:1},8,["model"])]),_:1})}const de=F(le,[["render",ne],["__scopeId","data-v-4aff88d7"]]),ce={data(){return{visible:!1,loading:!1,formState:{orderId:"",oldTrackingNo:"",newTrackingNo:""}}},methods:{show(o){this.visible=!0,this.formState.orderId=o.subOrderId,this.formState.oldTrackingNo=o.transhipmentTrackingNo},close(){this.$nextTick(()=>{this.$refs.refFormState.resetFields()})},onSubmit(){this.$refs.refFormState.validate(o=>{o&&(this.loading=!0,G({packageOrderId:this.$route.params.id,trackingNumber:this.formState.newTrackingNo}).then(()=>{this.$message.success("操作成功"),this.visible=!1,this.$emit("finish")}).finally(()=>{this.loading=!1}))})}}},ue={slot:"footer",class:"dialog-footer"};function me(o,e,p,m,t,a){const v=d("el-form-item"),k=d("el-input"),S=d("el-form"),g=d("el-button"),T=d("el-dialog");return c(),b(T,{width:"600px",modelValue:t.visible,"onUpdate:modelValue":e[3]||(e[3]=_=>t.visible=_),"close-on-click-modal":!1,title:"修改国际物流单号",onClose:a.close},{footer:i(()=>[s("span",ue,[l(g,{onClick:e[2]||(e[2]=_=>t.visible=!1)},{default:i(()=>e[4]||(e[4]=[n("取 消")])),_:1}),l(g,{type:"primary",loading:t.loading,onClick:a.onSubmit},{default:i(()=>e[5]||(e[5]=[n("确 定")])),_:1},8,["loading","onClick"])])]),default:i(()=>[l(S,{ref:"refFormState",model:t.formState,"label-width":"110px",onSubmit:e[1]||(e[1]=W(()=>{},["prevent"]))},{default:i(()=>[l(v,{label:"",prop:"orderId",style:{display:"none"}}),l(v,{label:"原物流单号："},{default:i(()=>[n(h(t.formState.oldTrackingNo),1)]),_:1}),l(v,{label:"新物流单号",rules:[{required:!0,message:"新物流单号不能为空"}],prop:"newTrackingNo"},{default:i(()=>[l(k,{modelValue:t.formState.newTrackingNo,"onUpdate:modelValue":e[0]||(e[0]=_=>t.formState.newTrackingNo=_),placeholder:"请输入",onKeyup:q(a.onSubmit,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","onClose"])}const pe=F(ce,[["render",me]]),he=J.state.order.payModelList,fe={data(){return{form:{},loading:!1,payModelList:he,orderInfo:{warehouseOrderNoList:[]},countDownTime:"",option1:{menu:!1,header:!1,align:"center",column:[{label:"仓库订单号",prop:"warehouseOrderNo"},{label:"仓库",prop:"warehouseName"},{label:"商品名称",prop:"productName"},{label:"商品图",prop:"img"},{label:"商品信息",prop:"info",align:"left"},{label:"重量（g）",prop:"weight"},{label:"体积（cm）",prop:"volume",formatter:o=>o.length+"*"+o.width+"*"+o.height},{label:"属性",prop:"attributes"}]},option2:{menu:!1,border:!0,header:!1,headerAlign:"center",align:"center",column:[{label:"收货信息",prop:"info"}]},option3:{menu:!1,border:!0,header:!1,headerAlign:"center",align:"center",column:[{label:"报关信息",prop:"skuName",children:[{label:"中文名",prop:"productName"},{label:"英文名",prop:"productNameEn"},{label:"申报金额 USD",prop:"amount"},{label:"预估税费 USD",prop:"taxes"},{label:"seel保险 USD",prop:"seelPrice"}]}]},option4:{menu:!1,border:!0,header:!1,headerAlign:"center",align:"center",column:[{label:"物流信息",prop:"skuName",children:[{label:"买家选择方式",prop:"deliverName"},{label:"实际物流方式",prop:"actualDeliverName"},{label:"预估押金（元）",prop:"estimateFreightDeposit",formatter:o=>I(o.estimateFreightDeposit,{sign:"￥"})},{label:"国际物流单号",prop:"transhipmentTrackingNo"},{label:"备注",prop:"remark"}]}]},option5:{menu:!1,border:!0,header:!1,headerAlign:"center",align:"center",column:[{label:"包裹信息",prop:"skuName",children:[{label:"包装方式",width:"200px",prop:"packingMethod",dicData:[{label:"纸箱包装(免费服务)",value:1},{label:"极简包装(免费服务)",value:2}]},{width:"200px",label:"包裹材料重量(g)",prop:"estimatePackWeight"},{label:"增值服务",prop:"addService"}]}]},stashData:[],takeData:[],clearanceData:[],flowData:[],packageInfoData:[],addServiceList:[{label:this.$t("addService1"),tip:this.$t("addServiceTip1"),value:1},{label:this.$t("addService2"),tip:this.$t("addServiceTip2"),value:2},{label:this.$t("addService3"),tip:this.$t("addServiceTip3"),value:3},{label:this.$t("addService4"),tip:this.$t("addServiceTip4"),value:4},{label:this.$t("addService5"),tip:this.$t("addServiceTip5"),value:5},{label:this.$t("addService6"),tip:this.$t("addServiceTip6"),value:6},{label:this.$t("addService7"),tip:this.$t("addServiceTip7"),value:7},{label:this.$t("addService8"),tip:this.$t("addServiceTip8"),value:8},{label:this.$t("addService9"),tip:this.$t("addServiceTip9"),value:9},{label:this.$t("addService10"),tip:this.$t("addServiceTip10"),value:10},{label:this.$t("addService11"),tip:this.$t("addServiceTip11"),value:11},{label:this.$t("addService12"),tip:this.$t("addServiceTip12"),value:12}]}},components:{countDown:ie,UploadVideo:de,TrackingNoEdit:pe},created(){this.getData()},methods:{editTrackingNo(){this.$refs.refTrackingNoEdit.show(this.flowData[0])},getData(){this.loading=!0,X({id:this.$route.params.id}).then(o=>{this.orderInfo=o.data||{},this.orderInfo.warehouseOrderNoList=o.data.warehouseOrderNoList||[];const e=o.data.warehouseOrderList||[],p=[];e.forEach(t=>{const a=[];t.skuDetailDTOList.forEach((v,k)=>{a.push(v)}),a[0]={...a[0],...t},p.push(...a)}),this.stashData=p,this.takeData=[{item:{label1:"收件人",value1:this.orderInfo.receiver,label2:"手机号",value2:this.orderInfo.receiverPhone,label3:"国家/地区",value3:this.orderInfo.country,label4:"邮编",value4:this.orderInfo.postCode,label5:"详细地址",value6:this.orderInfo.receiverAddress},length:10},{item:{label1:"包裹地址",value1:this.orderInfo.fullReceiverAddress},length:2},...(this.orderInfo.fullBillingAddressList||[]).map((t,a)=>({item:{label1:`账单地址${a+1}`,value1:t},length:2}))];const m=this.orderInfo.declarationType.declarationSkuDetails||[];m.length&&(m[0].weight=this.orderInfo.declarationType.weight,m[0].amount=I(this.orderInfo.declarationType.amount),m[0].taxes=I(this.orderInfo.declarationType.taxReportingFeeTrans),m[0].seelPrice=I(this.orderInfo.declarationType.seelPriceTrans),m[0].declarationSkuDetails=this.orderInfo.declarationType.declarationSkuDetails),this.clearanceData=m,this.packageInfoData=[{estimatePackWeight:this.orderInfo.estimatePackWeight,addService:this.orderInfo.addedServicesIdList||[],packingMethod:this.orderInfo.packingMethod}],this.flowData=[{deliverName:this.orderInfo.deliverName,actualDeliverName:this.orderInfo.actualDeliverName,estimateFreightDeposit:this.orderInfo.estimateFreightDeposit,transhipmentTrackingNo:this.orderInfo.transhipmentTrackingNo,remark:this.orderInfo.remark}],this.orderInfo.status==0&&(this.countDownTime=new Date(this.orderInfo.gmtCreateTime).getTime()+24*3*60*60*1e3)}).finally(()=>{this.loading=!1})},getLabel:H,convertFenToYuan:I,spanMethod1({row:o,columnIndex:e}){if(!(e===0||e===1||e===5||e===6))return o.skuDetailDTOList?{rowspan:o.skuDetailDTOList.length,colspan:1}:{rowspan:0,colspan:0}},spanMethod2({row:o,columnIndex:e}){if(!(e===0||e===1))return o.declarationSkuDetails?{rowspan:o.declarationSkuDetails.length,colspan:1}:{rowspan:0,colspan:0}},copyTxt(o,e){Z(e,o)},thStyle({rowIndex:o,columnIndex:e}){if(o===0)return"table-th-blue"},cellClassName({rowIndex:o,columnIndex:e}){return"take-tabl-cell"},finish(){this.getData()},checkAddService(o,e){return o&&o.includes(e)}}},ve={class:"detail fs14"},ge={class:"head"},_e={class:"stash-list"},be={class:"status"},ke={key:0,class:"con"},we={class:"title"},Se={class:"desc"},Te={class:"count-down"},De={key:1,class:"con"},ye={class:"title"},Ie={class:"stash-info"},Ne={class:"con"},Fe={class:"sku"},Ve={class:"num"},Le={class:"take-info"},xe={class:"add-service"},Ce={class:"add-service-item"};function Ue(o,e,p,m,t,a){const v=d("el-form-item"),k=d("el-form"),S=d("count-down"),g=d("el-card"),T=d("UploadVideo"),_=d("el-image"),D=d("avue-crud"),O=d("QuestionFilled"),E=d("el-icon"),P=d("el-tooltip"),V=d("el-checkbox"),L=d("el-checkbox-group"),$=d("el-button"),A=d("TrackingNoEdit"),B=U("loading");return M((c(),f("div",ve,[l(g,{shadow:"never"},{default:i(()=>[s("div",ge,[l(k,{class:"order-detail-form head-form",model:t.orderInfo,inline:""},{default:i(()=>[l(v,{label:"包裹订单号:"},{default:i(()=>[n(h(t.orderInfo.packageOrderNo),1)]),_:1}),l(v,{label:"创建时间:"},{default:i(()=>[n(h(t.orderInfo.gmtCreateTime),1)]),_:1}),s("div",_e,[(c(!0),f(w,null,y(t.orderInfo.warehouseOrderNoList,(r,u)=>(c(),b(v,{key:u,label:`仓库订单号${u+1}:`},{default:i(()=>[n(h(r),1)]),_:2},1032,["label"]))),128))])]),_:1},8,["model"])]),s("div",be,[t.orderInfo.status==0?(c(),f("div",ke,[s("div",we,h(t.orderInfo.statusDesc),1),s("div",Se,[e[4]||(e[4]=n(" 若买家未在 ")),s("span",null,[l(S,{end:t.countDownTime},{default:i(r=>[s("div",Te,[s("span",null,h(Number(r.d)*24+Number(r.hh)),1),e[1]||(e[1]=n("小时")),s("span",null,h(r.mm),1),e[2]||(e[2]=n("分钟")),s("span",null,h(r.ss),1),e[3]||(e[3]=n("秒 "))])]),_:1},8,["end"])]),e[5]||(e[5]=n(" 内付款，订单将按照设置逾期自动关闭 "))])])):(c(),f("div",De,[s("div",ye,h(t.orderInfo.statusDesc),1)]))])]),_:1}),l(T,{orderInfo:t.orderInfo,onFinish:a.finish},null,8,["orderInfo","onFinish"]),l(g,{class:"list",shadow:"never"},{default:i(()=>[l(D,{option:t.option1,"header-cell-class-name":a.thStyle,"span-method":a.spanMethod1,data:t.stashData},{img:i(r=>[l(_,{style:{width:"80px",height:"80px"},src:r.row.img,"preview-src-list":[r.row.img]},null,8,["src","preview-src-list"])]),info:i(r=>[s("div",Ie,[s("div",Ne,[s("div",Fe,[(c(!0),f(w,null,y(r.row.attrList,u=>(c(),f("span",{key:u.attrValue},[s("span",null,h(u.attrName)+":"+h(u.attrValue)+" ",1)]))),128))])]),s("div",Ve,"×"+h(r.row.skuCount),1)])]),default:i(()=>[e[6]||(e[6]=s("template",{slot:"empty"},[n(" 暂无数据 ")],-1))]),_:1},8,["option","header-cell-class-name","span-method","data"])]),_:1}),l(g,{class:"list",shadow:"never"},{default:i(()=>[l(D,{class:"take-table","header-cell-class-name":a.thStyle,"cell-class-name":a.cellClassName,modelValue:t.form,"onUpdate:modelValue":e[0]||(e[0]=r=>t.form=r),option:t.option2,data:t.takeData},{info:i(r=>[s("div",Le,[(c(!0),f(w,null,y(r.row.item,(u,z,x)=>(c(),f("div",{key:z,class:Y([x%2==0?"label":"value",x===r.row.length-1?"last-item":""])},h(u),3))),128))])]),default:i(()=>[e[7]||(e[7]=s("template",{slot:"empty"},[n(" 暂无数据 ")],-1))]),_:1},8,["header-cell-class-name","cell-class-name","modelValue","option","data"])]),_:1}),l(g,{class:"list",shadow:"never"},{default:i(()=>[l(D,{"header-cell-class-name":a.thStyle,option:t.option5,data:t.packageInfoData},{addService:i(r=>[s("div",xe,[l(L,{modelValue:r.row.addService,"onUpdate:modelValue":u=>r.row.addService=u,disabled:""},{default:i(()=>[(c(!0),f(w,null,y(t.addServiceList,u=>(c(),f("span",{key:u.value},[a.checkAddService(r.row.addService,u.value)?(c(),b(V,{key:0,checked:!0},{default:i(()=>[s("span",Ce,[n(h(u.label)+" ",1),l(P,{effect:"dark",placement:"top"},{content:i(()=>[n(h(u.tip),1)]),default:i(()=>[l(E,null,{default:i(()=>[l(O)]),_:1})]),_:2},1024)])]),_:2},1024)):N("",!0)]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])]),_:1},8,["header-cell-class-name","option","data"])]),_:1}),l(g,{class:"list",shadow:"never"},{default:i(()=>[l(D,{"header-cell-class-name":a.thStyle,option:t.option3,"span-method":a.spanMethod2,data:t.clearanceData},{attr:i(r=>[l(L,{modelValue:r.row.attr,"onUpdate:modelValue":u=>r.row.attr=u},{default:i(()=>[(c(!0),f(w,null,y(r.row.attr,u=>(c(),b(V,{label:u.label,key:u.label},{default:i(()=>[n(h(u.label),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),default:i(()=>[e[8]||(e[8]=s("template",{slot:"empty"},[n(" 暂无数据 ")],-1))]),_:1},8,["header-cell-class-name","option","span-method","data"])]),_:1}),l(g,{class:"list",shadow:"never"},{default:i(()=>[l(D,{"header-cell-class-name":a.thStyle,option:t.option4,data:t.flowData},{transhipmentTrackingNo:i(r=>[n(h(r.row.transhipmentTrackingNo)+"  ",1),l($,{type:"text",icon:"el-icon-edit",onClick:a.editTrackingNo},{default:i(()=>e[9]||(e[9]=[n("编辑")])),_:1},8,["onClick"])]),default:i(()=>[e[10]||(e[10]=s("template",{slot:"empty"},[n(" 暂无数据 ")],-1))]),_:1},8,["header-cell-class-name","option","data"])]),_:1}),l(A,{ref:"refTrackingNoEdit",onFinish:a.finish},null,8,["onFinish"])])),[[B,t.loading]])}const Be=F(fe,[["render",Ue],["__scopeId","data-v-0e3ebe83"]]);export{Be as default};
