import{c as L,g as D,a as W,s as R,b as T,d as x}from"./order-BawGe9CR.js";import{m as p,d as s,w as r,g as i,f as n,p as b,c as A,F as N,n as z,e as g,k as d,O as q,I as j,J as I,t as c,P as O,Q as U}from"./index-CrQX_ENc.js";import{a as F,c as _}from"./commonUtil-265gjw8e.js";import{p as P}from"./date-CHAm-pjJ.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                    *//* empty css              */const B={props:{type:{type:String,default:""},reasonList:{type:Array,require:!0,default:()=>[]}},data(){return{cancelVisible:!1,cancelLoading:!1,reasonForm:{orderId:"",remark:"",otherReason:""}}},methods:{show(t){this.cancelVisible=!0,this.reasonForm.orderId=t.orderId},close(){this.$nextTick(()=>{this.$refs.reasonForm.resetFields()})},cancelSureOrder(){this.$refs.reasonForm.validate(t=>{if(t){this.cancelLoading=!0;const e=L,l={};this.type==="package"&&(l.packageOrderId=this.reasonForm.orderId,l.remark=this.reasonForm.remark),e(l).then(()=>{this.$message.success("订单取消成功"),this.cancelVisible=!1,this.$emit("finish")}).finally(()=>{this.cancelLoading=!1})}})}}},E={slot:"footer",class:"dialog-footer"};function M(t,e,l,k,a,o){const u=i("el-form-item"),h=i("el-input"),S=i("el-option"),C=i("el-select"),w=i("el-form"),f=i("el-button"),v=i("el-dialog");return s(),p(v,{width:"500px",modelValue:a.cancelVisible,"onUpdate:modelValue":e[4]||(e[4]=m=>a.cancelVisible=m),"close-on-click-modal":!1,title:"取消订单",onClose:o.close},{footer:r(()=>[g("span",E,[n(f,{onClick:e[3]||(e[3]=m=>a.cancelVisible=!1)},{default:r(()=>e[5]||(e[5]=[d("取 消")])),_:1}),n(f,{type:"primary",loading:a.cancelLoading,onClick:o.cancelSureOrder},{default:r(()=>e[6]||(e[6]=[d("确 定")])),_:1},8,["loading","onClick"])])]),default:r(()=>[n(w,{ref:"reasonForm",model:a.reasonForm,"label-width":"80px"},{default:r(()=>[n(u,{label:"",prop:"orderId",style:{display:"none"}}),n(u,{label:"取消原因",rules:[{required:!0,message:"取消原因不能为空"}],prop:"remark"},{default:r(()=>[l.type==="package"?(s(),p(h,{key:0,modelValue:a.reasonForm.remark,"onUpdate:modelValue":e[0]||(e[0]=m=>a.reasonForm.remark=m),type:"textarea",resize:"none",rows:5,placeholder:"请输入取消原因"},null,8,["modelValue"])):(s(),p(C,{key:1,modelValue:a.reasonForm.remark,"onUpdate:modelValue":e[1]||(e[1]=m=>a.reasonForm.remark=m),style:{width:"100%"},size:"small",placeholder:"请选择取消原因"},{default:r(()=>[(s(!0),A(N,null,z(l.reasonList,m=>(s(),p(S,{key:m.dictKey,label:m.dictValue,value:m.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]),_:1}),a.reasonForm.remark==="其他原因"?(s(),p(u,{key:0,label:"原因",rules:[{required:!0,message:"原因不能为空"}],prop:"otherReason"},{default:r(()=>[n(h,{modelValue:a.reasonForm.otherReason,"onUpdate:modelValue":e[2]||(e[2]=m=>a.reasonForm.otherReason=m),type:"textarea",resize:"none",rows:5,placeholder:"请输入原因"},null,8,["modelValue"])]),_:1})):b("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","onClose"])}const G=V(B,[["render",M]]),H={data(){return{visible:!1,loading:!1,subLoading:!1,formState:{id:"",realAmount:"",realWeight:"",warehouseWeight:"",warehouseAmount:"",changeWeight:"",changeAmount:"",finallyAmount:"",reason:""},currFinallyAmount:"",countLoading:!1,debouncedFetchResult:q(this.getNewFreight,500)}},computed:{chaAmount(){return this.formState.finallyAmount&&this.formState.realAmount?(Number(this.formState.realAmount)-Number(this.formState.finallyAmount)).toFixed(2):""},adjustAmount(){return this.formState.finallyAmount&&this.currFinallyAmount&&Number(this.formState.finallyAmount)-Number(this.currFinallyAmount)!=0?(Number(this.formState.finallyAmount)-Number(this.currFinallyAmount)).toFixed(2):(this.formState.reason="","")}},methods:{validateChangeWeight(t,e,l){e&&Number(e)<=0?l(new Error("必须大于0")):l()},validateChangeAmount(t,e,l){e&&Number(e)<=0?l(new Error("必须大于0")):l()},validateFinallyAmount(t,e,l){e&&Number(e)<=0?l(new Error("必须大于0")):this.formState.changeAmount&&Number(e)<Number(this.formState.changeAmount)/2&&l(new Error("必须大于成本价的一半")),l()},handleCancel(){this.$refs.formRef.resetFields(),this.visible=!1},handleOk(){this.$refs.formRef.validate(t=>{t&&(this.subLoading=!0,R({packageOrderId:this.formState.id,weight:this.formState.changeWeight,costPrice:F(this.formState.changeAmount),finalPaymentPrice:F(this.formState.finallyAmount),adjustmentNote:this.formState.reason}).then(()=>{this.visible=!1,this.$message.success("操作成功"),this.$emit("finish")}).finally(()=>[this.subLoading=!1]))})},async show(t){this.visible=!0,this.loading=!0,this.formState.id=t.id;const e=await W({id:t.id});this.loading=!1,this.formState.realAmount=_(e.data.estimateFreightDeposit),this.formState.realWeight=e.data.estimatePackageWeight,this.formState.warehouseAmount=_(e.data.realFreightDeposit),this.formState.warehouseWeight=e.data.realPackageWeight},onWeightIpt(t){let e=t.replace(/[^0-9]/g,"");e.startsWith("0")&&e.length>1&&(e=e.slice(1)),this.formState.changeWeight=e,this.debouncedFetchResult()},changeAmountIpt(t){let e=t.replace(/[^0-9.]/g,"");e=e.replace(/(\..*?)\./g,"$1"),e=e.replace(/(\.\d{2})./g,"$1"),e.startsWith(".")&&(e=`0${e}`),e=e.replace(/^(0+)(\d)/,"$2"),this.formState.changeAmount=e,this.debouncedFetchResult()},finallyAmountIpt(t){let e=t.replace(/[^0-9.]/g,"");e=e.replace(/(\..*?)\./g,"$1"),e=e.replace(/(\.\d{2})./g,"$1"),e.startsWith(".")&&(e=`0${e}`),e=e.replace(/^(0+)(\d)/,"$2"),this.formState.finallyAmount=e},async getNewFreight(){if(!this.formState.changeWeight||!this.formState.changeAmount){this.formState.finallyAmount="",this.currFinallyAmount="";return}this.countLoading=!0;try{const t=await D({packageOrderId:this.formState.id,weight:this.formState.changeWeight,costPrice:F(this.formState.changeAmount)});this.formState.finallyAmount=_(t.data.data),this.currFinallyAmount=_(t.data.data)}catch{this.formState.finallyAmount="",this.currFinallyAmount=""}finally{this.countLoading=!1}}}},Y={class:"send-modal"},K={class:"weight"},J={class:"amount"},Q={class:"weight"},X={class:"amount"},Z={slot:"label"},$={slot:"footer",class:"dialog-footer"};function ee(t,e,l,k,a,o){const u=i("el-form-item"),h=i("el-col"),S=i("el-input"),C=i("el-row"),w=i("el-form"),f=i("el-button"),v=i("el-dialog"),m=j("loading");return s(),p(v,{modelValue:a.visible,"onUpdate:modelValue":e[4]||(e[4]=y=>a.visible=y),title:"订单发货",width:"900px",onClose:o.handleCancel},{footer:r(()=>[g("span",$,[n(f,{onClick:o.handleCancel},{default:r(()=>e[8]||(e[8]=[d(" 取消 ")])),_:1},8,["onClick"]),n(f,{type:"primary",loading:a.subLoading,onClick:o.handleOk},{default:r(()=>e[9]||(e[9]=[d("确定")])),_:1},8,["loading","onClick"])])]),default:r(()=>[I((s(),A("div",Y,[n(w,{ref:"formRef",model:a.formState,"label-width":"140px","label-align":"right"},{default:r(()=>[n(u,{style:{display:"none"},prop:"id",label:"ID"}),n(C,{gutter:0},{default:r(()=>[n(h,{span:12},{default:r(()=>[n(u,{label:"包裹预估重量：",prop:"realWeight"},{default:r(()=>[g("div",K,c(a.formState.realWeight||"--")+"g",1)]),_:1})]),_:1}),n(h,{span:12},{default:r(()=>[n(u,{label:"用户支付运费：",prop:"realAmount"},{default:r(()=>[g("div",J,c(a.formState.realAmount||"--")+"元",1)]),_:1})]),_:1}),n(h,{span:12},{default:r(()=>[n(u,{label:"仓库回传计费重：",prop:"warehouseWeight"},{default:r(()=>[g("div",Q,c(a.formState.warehouseWeight||"--")+"g",1)]),_:1})]),_:1}),n(h,{span:12},{default:r(()=>[n(u,{label:"仓库回传运费：",prop:"warehouseAmount"},{default:r(()=>[g("div",X,c(a.formState.warehouseAmount||"--")+"元",1)]),_:1})]),_:1}),n(h,{span:12},{default:r(()=>[n(u,{label:"计费重：",prop:"changeWeight",rules:[{required:!0,message:"请输入计费重：",trigger:"blur"},{validator:o.validateChangeWeight,trigger:["change","blur"]}]},{default:r(()=>[n(S,{modelValue:a.formState.changeWeight,"onUpdate:modelValue":e[0]||(e[0]=y=>a.formState.changeWeight=y),placeholder:"请输入",style:{width:"100%"},clearable:"",onInput:o.onWeightIpt},{default:r(()=>e[5]||(e[5]=[g("template",{slot:"append"},[d("g")],-1)])),_:1},8,["modelValue","onInput"])]),_:1},8,["rules"])]),_:1}),n(h,{span:12},{default:r(()=>[n(u,{label:"成本价：",prop:"changeAmount",rules:[{required:!0,message:"请输入成本价",trigger:"blur"},{validator:o.validateChangeAmount,trigger:["change","blur"]}]},{default:r(()=>[n(S,{modelValue:a.formState.changeAmount,"onUpdate:modelValue":e[1]||(e[1]=y=>a.formState.changeAmount=y),clearable:"",placeholder:"请输入成本价",onInput:o.changeAmountIpt},{default:r(()=>e[6]||(e[6]=[g("template",{slot:"append"},[d("元")],-1)])),_:1},8,["modelValue","onInput"])]),_:1},8,["rules"])]),_:1}),I((s(),p(h,{span:12},{default:r(()=>[n(u,{label:"实际应收运费：",prop:"finallyAmount",rules:[{required:!0,message:"请输入实际应收运费",trigger:"blur"},{validator:o.validateFinallyAmount,trigger:["change","blur"]}]},{default:r(()=>[n(S,{modelValue:a.formState.finallyAmount,"onUpdate:modelValue":e[2]||(e[2]=y=>a.formState.finallyAmount=y),onInput:o.finallyAmountIpt},{default:r(()=>e[7]||(e[7]=[g("template",{slot:"append"},[d("元")],-1)])),_:1},8,["modelValue","onInput"])]),_:1},8,["rules"])]),_:1})),[[m,a.countLoading]]),o.chaAmount&&Number(o.chaAmount)!=0?(s(),p(h,{key:0,span:12},{default:r(()=>[n(u,null,{default:r(()=>[g("template",Z,[g("span",{class:O(o.chaAmount>0?"success":"err")},c(o.chaAmount>0?"用户退款：":"用户需补款："),3)]),g("div",{class:O(o.chaAmount>0?"success":"err")},[d(c(Math.abs(o.chaAmount))+"元 ",1),o.adjustAmount&&Number(o.adjustAmount)!=0?(s(),A(N,{key:0},[d("（调整金额："+c(o.adjustAmount>0?"+":"")+c(o.adjustAmount)+"元）",1)],64)):b("",!0)],2)]),_:1})]),_:1})):b("",!0),o.adjustAmount&&Number(o.adjustAmount)!=0?(s(),p(h,{key:1,span:12},{default:r(()=>[n(u,{label:"金额修改原因：",prop:"reason",rules:[{required:!0,message:"请输入金额修改原因",trigger:["change","blur"]}]},{default:r(()=>[n(S,{modelValue:a.formState.reason,"onUpdate:modelValue":e[3]||(e[3]=y=>a.formState.reason=y),type:"textarea",autosize:{minRows:4}},null,8,["modelValue"])]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1},8,["model"])])),[[m,a.loading]])]),_:1},8,["modelValue","onClose"])}const te=V(H,[["render",ee],["__scopeId","data-v-3c95c13b"]]),re={name:"PackageOrderList",components:{CancelReason:G,ShippingDialog:te},data(){return{search:{orderStatus:"",time:[]},data:[],loading:!1,page:{pageSize:10,currentPage:1,total:0},query:{},option:{searchLabelWidth:120,searchMenuSpan:12,searchMenuPosition:"right",menuWidth:150,menuAlign:"center",addBtn:!1,editBtn:!1,delBtn:!1,column:[{label:"ID",prop:"id"},{label:"包裹单号",prop:"packageOrderNo",search:!0,searchOrder:9},{label:"国际物流单",prop:"trackingNo",search:!0,searchOrder:2,width:120,html:!0,formatter:t=>`<div>ID:${t.trackingNo==="0"?"--":t.trackingNo}</div><div>编号:${t.outSystemOrderNumber||"--"}</div>`},{label:"补款状态",prop:"waitDebt",search:!0,hide:!0,type:"select",dicData:[{label:"待补款",value:1}]},{label:"仓库订单号",prop:"warehouseOrderNo",search:!0,hide:!0,searchOrder:8},{label:"主订单ID",prop:"orderId",hide:!0,search:!0,searchOrder:7},{label:"用户ID",prop:"userId",search:!0,searchOrder:6,width:100},{label:"真实运费",prop:"finalPaymentPrice",formatter:t=>t.finalPaymentPrice?_(t.finalPaymentPrice,{sign:"￥"}):"--"},{label:"用户预支付运费",prop:"totalAmount",formatter:t=>_(t.totalAmount,{sign:"￥"})},{label:"待补款运费",prop:"debtAmount"},{label:"申报金额",prop:"gradeDiscount",width:120,formatter:t=>_(t.gradeDiscount,{sign:"￥"})},{label:"预估税费",prop:"taxReportingFee",width:120,formatter:t=>_(t.taxReportingFee,{sign:"￥"})},{label:"包裹状态",prop:"orderStatus",search:!0,searchOrder:3,type:"select",dicData:[],formatter:t=>t.orderStatusDesc},{label:"收件人",prop:"receiver",search:!0,searchOrder:5},{label:"创建时间",prop:"gmtCreateTime",type:"daterange",search:!0,searchRange:!0,valueFormat:"yyyy-MM-dd HH:mm:ss",defaultTime:["00:00:00","23:59:59"],pickerOptions:P,formatter:t=>t.gmtCreateTime},{label:"支付时间",prop:"gmtPayTime",type:"daterange",searchRange:!0,valueFormat:"yyyy-MM-dd HH:mm:ss",defaultTime:["00:00:00","23:59:59"],pickerOptions:P,formatter:t=>t.gmtPayTime},{label:"仓库签收时间",width:120,prop:"gmtPackageLogisticsDeliverTime"}]}}},created(){x({name:"com.x.bp.common.enums.PackageOrderStatusEnum"}).then(t=>{const e=t.data.map(l=>({label:l.desc,value:String(l.code)}));this.option.column.some(l=>{if(l.prop==="orderStatus")return l.dicData=[...e],!0})})},methods:{convertFenToYuan:_,getLabel:U,rowClassName({row:t}){return t.debtStatus?"has-debt-amount":""},searchChange(t,e){t.gmtCreateTime&&t.gmtCreateTime.length?(t.startGmtCreateTime=t.gmtCreateTime[0],t.endGmtCreateTime=t.gmtCreateTime[1]):(delete t.startGmtCreateTime,delete t.endGmtCreateTime),this.query=t,this.page.currentPage=1,this.onLoad(this.page,t),e()},searchReset(){this.query={},this.onLoad(this.page)},refreshChange(){this.onLoad(this.page,this.query)},currentChange(t){this.page.currentPage=t},sizeChange(t){this.page.pageSize=t},onLoad(t,e={}){this.loading=!0;const l={pageNo:t.currentPage,pageSize:t.pageSize,...Object.assign(e,this.query)};T(l).then(k=>{this.page.total=Number(k.total||0);const a=k.data||[];this.data=a}).finally(()=>{this.loading=!1})},toDetail(t){this.$router.push(`/package-detail/${t}`)},onShipping(t){this.$refs.refShippingDialog.show({id:t.id})},cancelOrder(t){this.$refs.refCancelReason.show({orderId:t.id})},finish(){this.refreshChange()}}},ae={class:"basic-container"},oe={key:0},ne={key:1},le={key:2};function se(t,e,l,k,a,o){const u=i("el-button"),h=i("router-link"),S=i("avue-crud"),C=i("CancelReason"),w=i("ShippingDialog");return s(),A("div",ae,[n(S,{option:a.option,"table-loading":a.loading,data:a.data,rowKey:"warehouseOrderNo","row-class-name":o.rowClassName,search:a.search,page:a.page,onSearchChange:o.searchChange,onSearchReset:o.searchReset,onCurrentChange:o.currentChange,onSizeChange:o.sizeChange,onRefreshChange:o.refreshChange,onOnLoad:o.onLoad},{menu:r((f,v)=>[n(u,{type:"text",onClick:m=>o.toDetail(f.row.id)},{default:r(()=>e[0]||(e[0]=[d("包裹详情")])),_:2},1032,["onClick"]),f.row.orderStatus===1?(s(),p(u,{key:0,style:{margin:"0 7px"},type:"text",onClick:m=>o.onShipping(f.row)},{default:r(()=>e[1]||(e[1]=[d("转运发货")])),_:2},1032,["onClick"])):b("",!0),[0,1,7].includes(f.row.orderStatus)?(s(),p(u,{key:1,style:{margin:"0 7px"},type:"text",onClick:m=>o.cancelOrder(f.row)},{default:r(()=>e[2]||(e[2]=[d("取消订单")])),_:2},1032,["onClick"])):b("",!0)]),"userId-form":r(()=>[n(h,{to:`/userDetail/index?id=${t.form.userId}`,style:{color:"#409eff"}},{default:r(()=>[d(c(t.row.userId),1)]),_:1},8,["to"])]),"actualPayAmount-form":r(()=>[d(c(o.getLabel(t.form.actualPayAmount,[])),1)]),"debtAmount-form":r(()=>[t.form.debtStatus?(s(),A(N,{key:0},[d(c(o.convertFenToYuan(t.form.debtAmount,{sign:"￥"})),1)],64)):b("",!0)]),"tradeNo-form":r(()=>[t.form.tradeNo?(s(),A("div",oe,"交易单号:"+c(t.form.tradeNo),1)):b("",!0),t.form.refundTradeNo?(s(),A("div",ne,"退款交易号:"+c(t.form.refundTradeNo),1)):b("",!0),t.form.twicePayTradeNo?(s(),A("div",le,"补缴交易号:"+c(t.form.twicePayTradeNo),1)):b("",!0)]),_:1},8,["option","table-loading","data","row-class-name","search","page","onSearchChange","onSearchReset","onCurrentChange","onSizeChange","onRefreshChange","onOnLoad"]),n(C,{ref:"refCancelReason",type:"package",onFinish:o.finish},null,8,["onFinish"]),n(w,{ref:"refShippingDialog",onFinish:o.finish},null,8,["onFinish"])])}const fe=V(re,[["render",se],["__scopeId","data-v-f9eae85d"]]);export{fe as default};
